# Auto-Update Setup Guide

## Overview
Your Tauri app now has auto-update functionality that checks for updates from GitHub releases on startup.

## What Was Added

### 1. Backend Changes
- **Cargo.toml**: Added `tauri-plugin-updater` dependency
- **main.rs**: 
  - Added updater plugin initialization
  - Added automatic update check on app startup
  - Added `check_for_updates` command for manual checks

### 2. Frontend Changes
- **package.json**: Added `@tauri-apps/plugin-updater` dependency

### 3. Configuration
- **tauri.conf.json**: Configured updater with GitHub endpoint and dialog

### 4. CI/CD
- **GitHub Actions Workflow**: Builds releases for macOS (ARM64 + x86_64), Ubuntu, and Windows

## Setup Required

### Step 1: Generate Signing Keys
For security, updates must be signed. Generate your signing keys:

```bash
npm run tauri signer generate -- -w ~/.tauri/myapp.key
```

This will output:
- Your private key (saved to `~/.tauri/myapp.key`)
- Your public key (printed to console)

### Step 2: Update Configuration
1. Copy the public key from the output
2. Open `src-tauri/tauri.conf.json`
3. Replace `YOUR_PUBLIC_KEY_HERE` with your actual public key

### Step 3: Add GitHub Secrets
Add these secrets to your GitHub repository (Settings → Secrets → Actions):

1. **TAURI_PRIVATE_KEY**: The contents of `~/.tauri/myapp.key`
2. **TAURI_KEY_PASSWORD**: The password you used when generating the key

### Step 4: Create a Release
1. Update version in both `package.json` and `src-tauri/tauri.conf.json`
2. Commit and push changes
3. Create a tag and push it:
   ```bash
   git tag v0.2.0
   git push origin v0.2.0
   ```
4. The GitHub Action will automatically build and create a draft release
5. Review and publish the release

## How It Works

### Automatic Updates
- When the app starts, it checks for updates from GitHub
- If an update is found, it downloads and installs automatically
- Users are prompted with a dialog (can be customized)

### Update Endpoint
Updates are fetched from:
```
https://github.com/1mshy/movie-browser/releases/latest/download/latest.json
```

This file is automatically generated by the GitHub Action when you create a release.

### Manual Update Check
You can also add a button in your UI to manually check for updates:

```javascript
import { check } from '@tauri-apps/plugin-updater';
import { relaunch } from '@tauri-apps/plugin-process';

async function checkForUpdates() {
  const update = await check();
  if (update?.available) {
    console.log(`Update to ${update.version} available!`);
    await update.downloadAndInstall();
    await relaunch();
  }
}
```

Or use the Rust command:
```javascript
import { invoke } from '@tauri-apps/api/core';

const result = await invoke('check_for_updates');
console.log(result);
```

## Version Management

**Important**: Keep versions synchronized!
- `package.json` → "version" field
- `src-tauri/tauri.conf.json` → "version" field
- `src-tauri/Cargo.toml` → "version" field

## Troubleshooting

### "Updater not configured" error
Make sure you've replaced `YOUR_PUBLIC_KEY_HERE` in `tauri.conf.json` with your actual public key.

### Update not detected
- Ensure the version in your release tag is higher than the current app version
- Check that the release is published (not draft)
- Verify the update manifest exists at the endpoint URL

### Signature verification failed
- Ensure the private key used to sign the release matches the public key in your config
- Check that GitHub secrets are correctly set

## Security Notes

- **Never commit your private key** to the repository
- Keep your private key and password secure
- The private key is only used in GitHub Actions via secrets
- Users download signed updates verified against your public key

## Customization

### Disable Auto-Update on Startup
Remove the `.setup()` block from `main.rs` if you only want manual updates.

### Change Update Dialog
Modify `"dialog": true` to `"dialog": false` in `tauri.conf.json` to handle updates programmatically.

### Custom Update Endpoint
Change the endpoint in `tauri.conf.json` if hosting updates elsewhere.

## Next Steps

1. Generate your signing keys
2. Update the public key in configuration
3. Add GitHub secrets
4. Create your first release tag
5. Test the update process

For more details, see: https://v2.tauri.app/plugin/updater/
